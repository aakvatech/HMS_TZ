{
 "absolute_value": 0,
 "align_labels_right": 0,
 "creation": "2021-07-09 11:31:17.579435",
 "css": ".print-format {\r\n    font-size: 10pt;\r\n    padding: 0.5in;\r\n}\r\n\r\n.print-heading {\r\n    text-align: center;\r\n    padding-bottom: 5px;\r\n}\r\n\r\nhr {\r\n    margin-top: 10px;\r\n    margin-bottom: 5px;\r\n}\r\n\r\ntable {\r\n    font-size: 11px;\r\n}\r\n\r\n.print-format td, .print-format th {\r\n    padding: 2px !important;\r\n}\r\n\r\n@media print {\r\n    #footer-html {\r\n        display: flex;\r\n        flex-direction: column;\r\n    }\r\n}",
 "custom_format": 0,
 "default_print_language": "en",
 "disabled": 0,
 "doc_type": "Inpatient Record",
 "docstatus": 0,
 "doctype": "Print Format",
 "font": "Default",
 "format_data": "[{\"fieldname\": \"print_heading_template\", \"fieldtype\": \"Custom HTML\", \"options\": \"<div class=\\\"print-heading\\\">\\t\\n    <h2>Itemized Bill</h2>\\n</div>\"}, {\"fieldtype\": \"Section Break\", \"label\": \"\"}, {\"fieldtype\": \"Column Break\"}, {\"fieldname\": \"patient\", \"print_hide\": 0, \"label\": \"Patient\"}, {\"fieldtype\": \"Column Break\"}, {\"fieldname\": \"patient_name\", \"print_hide\": 0, \"label\": \"Patient Name\"}, {\"fieldtype\": \"Section Break\", \"label\": \"Insurance\"}, {\"fieldtype\": \"Column Break\"}, {\"fieldname\": \"insurance_subscription\", \"print_hide\": 0, \"label\": \"Insurance Subscription\"}, {\"fieldtype\": \"Column Break\"}, {\"fieldname\": \"insurance_company\", \"print_hide\": 0, \"label\": \"Insurance Company\"}, {\"fieldtype\": \"Section Break\", \"label\": \"\"}, {\"fieldtype\": \"Column Break\"}, {\"fieldname\": \"_custom_html\", \"print_hide\": 0, \"label\": \"Custom HTML\", \"fieldtype\": \"HTML\", \"options\": \"{% if doc.admitted_datetime %}\\r\\n    <div class=\\\"row  data-field\\\" data-fieldname=\\\"patient\\\" data-fieldtype=\\\"Link\\\">\\r\\n    \\t<div class=\\\"col-xs-5\\\">\\r\\n        \\t<label>Admission Date</label>\\r\\n        </div>\\r\\n        <div class=\\\"col-xs-7 value\\\">           \\r\\n             {{ frappe.utils.formatdate(doc.admitted_datetime, \\\"dd-MMM-yyyy\\\") }}\\r\\n    \\t</div>\\r\\n    </div>\\r\\n{% endif %}\\r\\n{#.strftime('%d-%b-%Y'#}\"}, {\"fieldtype\": \"Column Break\"}, {\"fieldname\": \"_custom_html\", \"print_hide\": 0, \"label\": \"Custom HTML\", \"fieldtype\": \"HTML\", \"options\": \"\\r\\n{% if doc.discharge_date %}\\r\\n<div class=\\\"row  data-field\\\" data-fieldname=\\\"patient\\\" data-fieldtype=\\\"Link\\\">\\r\\n\\t<div class=\\\"col-xs-5\\\">\\r\\n    \\t<label>Discharge Date</label>\\r\\n    </div>\\r\\n    <div class=\\\"col-xs-7 value\\\">\\r\\n         {{ frappe.utils.formatdate(doc.discharge_date, \\\"dd-MMM-yyyy\\\") }}\\r\\n\\t</div>\\r\\n</div>\\r\\n{% endif %}\"}, {\"fieldtype\": \"Section Break\", \"label\": \"\"}, {\"fieldtype\": \"Column Break\"}, {\"fieldname\": \"_custom_html\", \"print_hide\": 0, \"label\": \"Custom HTML\", \"fieldtype\": \"HTML\", \"options\": \"{% set bill = [] %}\\n{% if doc.name %}\\n    {% set reference_encounter = frappe.db.get_value(\\\"Patient Encounter\\\",doc.admission_encounter, \\\"reference_encounter\\\") %}\\n    {% set encounter = frappe.db.get_all(\\\"Patient Encounter\\\", {\\\"reference_encounter\\\": reference_encounter}, \\\"name\\\") %}\\n    {% set encounter_list = (encounter[:encounter|length]|join(\\\",\\\", attribute=\\\"name\\\")) %}\\n    {% if encounter_list %}\\n        \\n        \\n        {##### LAB TEST #####}\\n        {% set lab_presc = frappe.db.get_all(\\\"Lab Prescription\\\", {'parent': [\\\"in\\\", encounter_list]}, ['lab_test_code', 'lab_test_name', 'amount', 'creation']) %}\\n        {% for lab in lab_presc %}\\n            {% set date = frappe.utils.formatdate(lab.creation, 'dd-mmmm-yyyy') %}\\n            {% set rate = lab.amount %}\\n            {% set qty = 1 %}\\n            {# {% set uom = frappe.db.get_value(\\\"Lab Test Template\\\", lab.lab_test_code, \\\"lab_test_uom\\\") %}  #}\\n            {% set category = frappe.db.get_value(\\\"Lab Test Template\\\", lab.lab_test_code, ['lab_test_group']) %}\\n            {% set _ = bill.append({\\\"date\\\": date, \\\"category\\\": category, \\\"item_name\\\": lab.lab_test_code , \\\"qty\\\": qty, 'rate': rate, \\\"amount\\\": lab.amount }) %}\\n       {% endfor %}\\n        \\n        \\n        {##### RADIOLOGY EXAMINATION #####}\\n        {% set rad_exams = frappe.db.get_all(\\\"Radiology Procedure Prescription\\\", {'parent': [\\\"in\\\", encounter_list]}, ['radiology_examination_template', 'radiology_procedure_name', 'amount', 'creation'] ) %}\\n        {% for rad in rad_exams %}\\n           {% set date = frappe.utils.formatdate(rad.creation, 'dd-mmmm-yyyy') %}\\n           {% set rate = rad.amount %}\\n           {% set qty = 1 %}\\n           {# {% set uom = frappe.db.get_value(\\\"Radiology Examination Template\\\", rad.radiology_examination_template, \\\"medical_code_standard\\\") %}  #}\\n           {% set category = frappe.db.get_value(\\\"Radiology Examination Template\\\", rad.radiology_examination_template, ['item_group']) %}\\n           {% set _ = bill.append({\\\"date\\\": date, \\\"category\\\": category, \\\"item_name\\\": rad.radiology_examination_template , \\\"qty\\\": qty, 'rate': rate, \\\"amount\\\": rad.amount }) %}\\n        {% endfor %}\\n        \\n        \\n        \\n        {##### CLINICAL PROCEDURE #####}\\n        {% set proc_presc = frappe.db.get_all(\\\"Procedure Prescription\\\", {'parent': [\\\"in\\\", encounter_list]}, ['procedure', 'procedure_name', 'amount', 'creation'] ) %}\\n        {% for clin in proc_presc %}\\n            {% set date = frappe.utils.formatdate(clin.creation, 'dd-mmmm-yyyy') %}\\n            {% set rate = clin.amount %}\\n            {% set qty = 1 %}\\n            {# {% set uom = frappe.db.get_value(\\\"Clinical Procedure Template\\\", clin.procedure, ['sample_uom']) %} #}\\n            {% set category = frappe.db.get_value(\\\"Clinical Procedure Template\\\", clin.procedure, ['item_group']) %}\\n            {% set _ = bill.append({\\\"date\\\": date, \\\"category\\\": category, \\\"item_name\\\": clin.procedure_name , \\\"qty\\\": qty, 'rate': rate, \\\"amount\\\": clin.amount }) %}\\n        {% endfor %}\\n    \\n    \\n    \\n        {##### MEDICATION #####}\\n        {% set drug_presc = frappe.db.get_all(\\\"Drug Prescription\\\", {'parent': [\\\"in\\\", encounter_list]}, ['drug_code', 'drug_name', 'amount', 'quantity', 'creation'] ) %}\\n        {% for drug in drug_presc %}\\n            {% set date = frappe.utils.formatdate(drug.creation, 'dd-mmmm-yyyy') %}\\n            {% set amount2 = (drug.quantity * drug.amount) %}\\n            {# {% set uom = frappe.db.get_value(\\\"Medication\\\", drug.drug_code, ['stock_uom']) %}   #}\\n            {% set category = frappe.db.get_value(\\\"Medication\\\", drug.drug_code, ['item_group']) %}\\n            {% set _ = bill.append({\\\"date\\\": date, \\\"category\\\": category, \\\"item_name\\\": drug.drug_code , \\\"qty\\\": drug.quantity,  'rate': drug.amount, \\\"amount\\\": amount2 }) %}\\n        {% endfor %}\\n    \\n    \\n\\n        {##### THERAPIES #####}\\n        {% set ther_plan = frappe.db.get_all(\\\"Therapy Plan Detail\\\", {'parent': [\\\"in\\\", encounter_list]}, ['therapy_type', 'amount', 'creation'] ) %}\\n        {% for ther in ther_plan %}\\n            {% set date = frappe.utils.formatdate(ther.creation, 'dd-mmmm-yyyy') %}\\n            {% set rate = ther.amount %}\\n            {% set qty = 1 %}\\n            {# {% set uom = frappe.db.get_value(\\\"Therapy Type\\\", ther.therapy_type, ['item_group']) %} #}\\n            {% set category = frappe.db.get_value(\\\"Therapy Type\\\", ther.therapy_type, ['item_group']) %}\\n            {% set _ = bill.append({\\\"date\\\": date, \\\"category\\\": category, \\\"item_name\\\": ther.therapy_type , \\\"qty\\\": qty,  'rate': rate, \\\"amount\\\": ther.amount }) %}\\n       {% endfor %} \\n        \\n        {% if doc.insurance_subscription %}\\n        \\n            {##### IPD BED CHARGES FOR INSURANCE #####}\\n            {% set bed_charges = frappe.db.get_all(\\\"Inpatient Occupancy\\\", filters={'invoiced': 1, 'parent': doc.name}, fields=['check_in', 'service_unit'], order_by='check_in asc') %}    \\n            {% for bed in bed_charges %}\\n                {% set hsut = frappe.db.get_value('Healthcare Service Unit', bed.service_unit, 'service_unit_type') %}\\n                {% set item_name = frappe.db.get_value('Healthcare Service Unit Type', hsut, 'item') %}\\n                {% set category = frappe.db.get_value('Healthcare Service Unit Type', hsut, 'item_group') %}\\n                {% set item_rate = get_item_rate(item_name, doc.company, doc.insurance_subscription) %}\\n                {% set amount = item_rate * 1 %}\\n                {% set _ = bill.append({\\\"date\\\": bed.check_in, \\\"category\\\": category, \\\"item_name\\\": item_name , \\\"qty\\\": 1,  'rate': item_rate, \\\"amount\\\": amount }) %}\\n            {% endfor %}\\n            \\n            \\n            \\n            {##### IPD BED CONS  FOR INSURANCE #####}\\n            {% set ipd_cons = frappe.db.get_all(\\\"Inpatient Consultancy\\\", filters={'parent': doc.name}, fields=['date', 'consultation_item','rate'], order_by='date asc') %}\\n            {% for ipdc in ipd_cons %}\\n                {% set category = frappe.db.get_value('Item', ipdc.consultation_item, 'item_group') %}\\n                {% set item_uom = frappe.db.get_value('Item', ipdc.consultation_item, 'stock_uom') %}\\n                {% set item_rate = get_item_rate(ipdc.consultation_item, doc.company, doc.insurance_subscription) %}\\n                {% set amount = item_rate * 1 %}\\n                {% set _ = bill.append({\\\"date\\\": ipdc.date, \\\"category\\\": category, \\\"item_name\\\": ipdc.consultation_item , \\\"qty\\\": 1,  'rate': item_rate, \\\"amount\\\": amount }) %}\\n            {% endfor %}\\n            \\n        {% else %}\\n\\n\\n            {##### IPD BED CHARGES FOR CASH #####}\\n            {% set bed_charges = frappe.db.get_all(\\\"Inpatient Occupancy\\\", filters={'parent': doc.name}, fields=['check_in', 'service_unit'], order_by='check_in asc') %}    \\n            {% for item in bed_charges %}\\n                {% set hsu = frappe.db.get_value('Healthcare Service Unit', item.service_unit, 'service_unit_type') %}\\n                {% set item_category = frappe.db.get_value('Healthcare Service Unit Type', hsu, 'item_group') %}\\n                {% set price_list = \\\"SHMH-DSM Cash Price\\\" %}\\n                {% set item_rate = frappe.db.get_value('Item Price', {'item_code' : hsu, 'price_list': price_list}, 'price_list_rate') %}\\n                {% set _ = item.update({\\\"item_name\\\": item.service_unit, \\\"date\\\": item.check_in, \\\"category\\\": item_category, \\\"qty\\\": 1, \\\"rate\\\": item_rate, \\\"amount\\\": item_rate  }) %}\\n                {% set bill = bill.append(item) %}\\n            {% endfor %}\\n            \\n            \\n            {##### IPD BED CONS FOR CASH #####}\\n            {% set ipd_cons = frappe.db.get_all(\\\"Inpatient Consultancy\\\", filters={'parent': doc.name}, fields=['date', 'consultation_item','rate'], order_by='date asc') %}\\n            {% for item in ipd_cons %}\\n                {% set item_category = frappe.db.get_value('Item', item.consultation_item, 'item_group') %}\\n                {% set _ = item.update({\\\"item_name\\\": item.consultation_item, \\\"category\\\": item_category, \\\"qty\\\": 1, \\\"rate\\\": item.rate,  \\\"amount\\\": item.rate  }) %}\\n                {% set bill = bill.append(item) %}\\n            {% endfor %}\\n        {% endif %}\\n       \\n       \\n       \\n       <TABLE border=1 style=\\\"width: 100%; border-collapse: collapse; border: 1px grey; margin-bottom: 10px;\\\">\\n            <COLGROUP>\\n               <COL WIDTH=\\\"5%\\\">\\n               <COL WIDTH=\\\"11%\\\">\\n               <COL WIDTH=\\\"24%\\\">\\n               <COL WIDTH=\\\"37%\\\">\\n               <COL WIDTH=\\\"5%\\\">\\n               <COL WIDTH=\\\"8%\\\">\\n               <COL WIDTH=\\\"15%\\\">    \\n            </COLGROUP>\\n            <THEAD style=\\\"background-color: darkgray;\\\">\\n               <TR>\\n                  <TH style=\\\"text-align: center;\\\">&nbsp;</TH>\\n                  <TH style=\\\"text-align: center;\\\">Date</TH>\\n                  <TH style=\\\"text-align: center;\\\">Category</TH>\\n                  <TH style=\\\"text-align: center;\\\">Description</TH>\\n                  <TH style=\\\"text-align: center;\\\">Qty</TH>\\n                  <TH style=\\\"text-align: center;\\\">Rate</TH>\\n                  <TH style=\\\"text-align: center;\\\">Amount</TH>        \\n               </TR>\\n            </THEAD>\\n            <TBODY>\\n               {% set total = [0] %}\\n               {% for item in bill %}\\n                  {% set total = total.append(total.pop() + item.amount) %}\\n                  <TR>\\n                     <TD style=\\\"text-align: center;\\\">{{ loop.index }}</TD>\\n                     <TD style=\\\"text-align: center;\\\">{{ frappe.utils.formatdate(item.date, \\\"dd-MMM-yyyy\\\") }}</TD>\\n                     <TD style=\\\"text-align: left;\\\">{{ item.category }}</TD>\\n                     <TD style=\\\"text-align: left;\\\">{{ item.item_name }}</TD>\\n                     <TD style=\\\"text-align: center;\\\">{{ item.qty|int }}</TD>\\n                     <TD style=\\\"text-align: right;\\\">{{ frappe.utils.fmt_money(item.rate) }}</TD>\\n                     <TD style=\\\"text-align: right;\\\">{{ frappe.utils.fmt_money(item.amount, precision=2) }}</TD>\\n                  </TR>\\n               {% endfor %}\\n            </TBODY>\\n            <TFOOT>\\n               <TR>\\n                  <TD style=\\\"text-align: center;\\\">&nbsp;</TD>\\n                  <TD style=\\\"text-align: left;\\\" colspan=\\\"5\\\">TOTAL</TD>\\n                  <TD style=\\\"text-align: right;\\\">{{ frappe.utils.fmt_money(total[0], precision=2) }}</TD>\\n                  \\n               </TR> \\n            </TFOOT>\\n        </TABLE>\\n    {% endif %}\\n{% endif %}\"}, {\"fieldtype\": \"Section Break\", \"label\": \"\"}, {\"fieldtype\": \"Column Break\"}, {\"fieldname\": \"_custom_html\", \"print_hide\": 0, \"label\": \"Custom HTML\", \"fieldtype\": \"HTML\", \"options\": \"<p class=\\\"text-center\\\">Printed By: <b>{{ frappe.db.get_value(\\\"User\\\", frappe.session.user, \\\"full_name\\\") }}</b></p>\"}]",
 "idx": 0,
 "line_breaks": 0,
 "modified": "2021-07-09 11:36:44.374911",
 "modified_by": "Administrator",
 "module": "Hms Tz",
 "name": "IPD Itemized Bill",
 "owner": "Administrator",
 "print_format_builder": 0,
 "print_format_type": "Jinja",
 "raw_printing": 0,
 "show_section_headings": 0,
 "standard": "Yes"
}